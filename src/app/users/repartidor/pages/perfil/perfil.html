<app-header></app-header>
<div class="content">
  <div class="perfil-container">
    <h2>Mi Perfil de Repartidor</h2>
    @if (authService.currentUser(); as usuario) {
      <p>
        Bienvenido, <strong>{{ usuario.nombre }}</strong>
      </p>
    }

    <!-- Mensaje de √©xito o error -->
    @if (mensajePerfil && tipoMensaje) {
      <div
        class="alert-message"
        [class.alert-success]="tipoMensaje === 'success'"
        [class.alert-error]="tipoMensaje === 'error'"
      >
        <span class="alert-icon">{{ tipoMensaje === 'success' ? '‚úì' : '‚ö†' }}</span>
        <span class="alert-text">{{ mensajePerfil }}</span>
      </div>
    }

    @if (loading()) {
      <div class="loading-section">
        <div class="loading-spinner"></div>
        <p>Cargando datos del perfil...</p>
      </div>
    } @else {
      <div class="perfil-content">
        <form class="perfil-form" [formGroup]="perfilForm" (ngSubmit)="alEnviar()">
          <h3>Informaci√≥n Personal</h3>

          <div class="form-row">
            <div class="form-group">
              <label>Nombre Completo *</label>
              <input
                type="text"
                formControlName="nombre"
                class="form-input"
                placeholder="Ingresa tu nombre completo"
                maxlength="50"
              />
              @if (perfilForm.get('nombre')?.invalid && perfilForm.get('nombre')?.touched) {
                <small style="color: red">Nombre requerido (m√≠nimo 3 caracteres)</small>
              }
            </div>

            <div class="form-group">
              <label>Usuario *</label>
              <input
                type="text"
                formControlName="usuario"
                class="form-input"
                placeholder="Nombre de usuario"
                maxlength="18"
              />
              @if (perfilForm.get('usuario')?.invalid && perfilForm.get('usuario')?.touched) {
                <small style="color: red">Usuario requerido (solo letras y n√∫meros)</small>
              }
            </div>
          </div>

          <div class="form-group">
            <label>Email *</label>
            <input
              type="email"
              formControlName="email"
              class="form-input"
              placeholder="tu@email.com"
              maxlength="100"
            />
            @if (perfilForm.get('email')?.invalid && perfilForm.get('email')?.touched) {
              <small style="color: red">Email requerido y v√°lido</small>
            }
          </div>

          <h3>Informaci√≥n de Entrega</h3>

          <div class="form-row">
            <div class="form-group">
              <label>Tipo de Veh√≠culo *</label>
              <select formControlName="tipoVehiculo" class="form-input">
                <option value="">Selecciona tu veh√≠culo</option>
                <option value="BICICLETA">Bicicleta</option>
                <option value="MOTO">Moto</option>
                <option value="AUTO">Auto</option>
              </select>
              @if (
                perfilForm.get('tipoVehiculo')?.invalid && perfilForm.get('tipoVehiculo')?.touched
              ) {
                <small style="color: red">Tipo de veh√≠culo requerido</small>
              }
            </div>

            <div class="form-group">
              <label>Pa√≠s *</label>
              <input type="text" formControlName="pais" class="form-input" placeholder="Tu pa√≠s" />
              @if (perfilForm.get('pais')?.invalid && perfilForm.get('pais')?.touched) {
                <small style="color: red">Pa√≠s requerido</small>
              }
            </div>
          </div>

          <div class="form-group">
            <label>Contrase√±a Actual *</label>
            <input
              type="password"
              formControlName="contrasenia"
              class="form-input"
              placeholder="Ingresa tu contrase√±a actual para verificar identidad"
            />
            @if (perfilForm.get('contrasenia')?.invalid && perfilForm.get('contrasenia')?.touched) {
              <small style="color: red">Contrase√±a requerida (m√≠nimo 6 caracteres)</small>
            }
          </div>

          <div class="form-actions">
            <button type="submit" class="btn-primary" [disabled]="loading()">
              @if (loading()) {
                Guardando...
              } @else {
                Guardar Cambios
              }
            </button>
          </div>
        </form>

        <div class="quick-links">
          <h3>Acciones de Cuenta</h3>
          <button class="link-card" (click)="cambiarContrasenia()">
            <div>
              <h4>Cambiar Contrase√±a</h4>
              <p>Actualiza tu contrase√±a de acceso</p>
            </div>
            <span class="flecha">‚Üí</span>
          </button>
        </div>

        @if (usuario(); as u) {
          <div class="estadisticas-section">
            <h3>Mis Estad√≠sticas</h3>
            <div class="stats-table-container">
              <table class="stats-table">
                <thead>
                  <tr>
                    <th>M√©trica</th>
                    <th class="text-right">Valor</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="stat-row">
                    <td class="metric-name">
                      <span class="metric-icon">üì¶</span>
                      Total de Entregas
                    </td>
                    <td class="metric-value">{{ u.totalPedidosEntregados || 0 }}</td>
                  </tr>
                  <tr class="stat-row highlighted">
                    <td class="metric-name">
                      <span class="metric-icon">‚≠ê</span>
                      Calificaci√≥n Promedio
                    </td>
                    <td class="metric-value rating">
                      <span class="rating-number">{{
                        u.calificacionPromedio.toFixed(1) || 'N/A'
                      }}</span>
                      <span class="rating-star">‚≠ê</span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>

<app-footer-repartidor></app-footer-repartidor>

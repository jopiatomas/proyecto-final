<app-header></app-header>
<div class="content">
  <div class="historial-container">
    <h2>Historial de Entregas</h2>
    <p>Revisa todos tus pedidos entregados</p>

    @if (loading()) {
      <div class="loading">
        <div class="loading-spinner"></div>
        <p>Cargando tu historial...</p>
      </div>
    } @else {
      <div class="historial-section">
        <!-- Filtros -->
        <div class="filtros">
          <button class="filtro-btn" [class.active]="!filtroEstado()" (click)="cambiarFiltro('')">
            Todos ({{ historial().length }})
          </button>
          <button
            class="filtro-btn"
            [class.active]="filtroEstado() === 'entregado'"
            (click)="cambiarFiltro('entregado')"
          >
            Entregados
          </button>
          <button
            class="filtro-btn"
            [class.active]="filtroEstado() === 'cancelado'"
            (click)="cambiarFiltro('cancelado')"
          >
            Cancelados
          </button>
        </div>

        @if (historialFiltrado().length > 0) {
          <div class="tabla-container">
            <table class="historial-tabla">
              <thead>
                <tr>
                  <th class="col-id">ID Pedido</th>
                  <th class="col-restaurante">Restaurante</th>
                  <th class="col-cliente">Cliente</th>
                  <th class="col-fecha">Fecha</th>
                  <th class="col-monto">Monto</th>
                  <th class="col-estado">Estado</th>
                </tr>
              </thead>
              <tbody>
                @for (entrega of historialFiltrado(); track entrega.id) {
                  <tr class="tabla-fila" [class.entregado]="entrega.estado === 'ENTREGADO'">
                    <td class="col-id">
                      <span class="pedido-badge">#{{ entrega.id }}</span>
                    </td>
                    <td class="col-restaurante">{{ entrega.restauranteNombre }}</td>
                    <td class="col-cliente">{{ entrega.clienteNombre }}</td>
                    <td class="col-fecha">{{ entrega.fecha | date: 'dd/MM/yyyy HH:mm' }}</td>
                    <td class="col-monto">${{ entrega.total }}</td>
                    <td class="col-estado">
                      <span class="estado-badge" [class.entregado]="entrega.estado === 'ENTREGADO'">
                        {{ entrega.estado }}
                      </span>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>

          <!-- Resumen -->
          <div class="resumen-section">
            <div class="resumen-card">
              <p class="label">Total de Entregas</p>
              <p class="valor">{{ historialFiltrado().length }}</p>
            </div>
            <div class="resumen-card">
              <p class="label">Monto Total</p>
              <p class="valor">${{ calcularMontoTotal().toFixed(2) }}</p>
            </div>
            <div class="resumen-card">
              <p class="label">Promedio por Entrega</p>
              <p class="valor">${{ calcularPromedioPorEntrega().toFixed(2) }}</p>
            </div>
          </div>
        } @else {
          <div class="sin-historial">
            <div class="sin-historial-icon">ðŸ“­</div>
            <h3>No hay entregas registradas</h3>
            <p>AÃºn no has completado ningÃºn pedido. Â¡Comienza a entregar!</p>
            <button class="btn-volver" (click)="volverAlPanel()">Volver al Panel</button>
          </div>
        }
      </div>
    }
  </div>
</div>
<app-footer-repartidor></app-footer-repartidor>

<app-header></app-header>

<!-- Modal de ConfirmaciÃ³n -->
@if (mostrarModalConfirmacion()) {
  <div class="modal-overlay" (click)="cerrarModalConfirmacion()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ modalTitulo() }}</h3>
        <button class="close-btn" (click)="cerrarModalConfirmacion()">Ã—</button>
      </div>
      <div class="modal-body">
        <p>{{ modalMensaje() }}</p>
      </div>
      <div class="modal-actions">
        <button class="btn-confirmar" (click)="confirmarEntrega()" [disabled]="marcandoEntregado()">
          {{ marcandoEntregado() ? 'Procesando...' : 'SÃ' }}
        </button>
        <button
          class="btn-cancelar"
          (click)="cerrarModalConfirmacion()"
          [disabled]="marcandoEntregado()"
        >
          Cancelar
        </button>
      </div>
    </div>
  </div>
}

<!-- Modal de Ã‰xito/Error -->
@if (mostrarModalExito()) {
  <div class="modal-overlay" (click)="cerrarModalExito()">
    <div class="modal-content" [class.success]="modalTitulo() === 'Â¡Buen Trabajo!'">
      <div class="modal-header">
        <h3>{{ modalTitulo() }}</h3>
      </div>
      <div class="modal-body">
        <div class="modal-icon">
          {{ modalTitulo() === 'Â¡Buen Trabajo!' ? 'âœ“' : 'âš ' }}
        </div>
        <p>{{ modalMensaje() }}</p>
      </div>
      <div class="modal-actions">
        <button class="btn-ok" (click)="cerrarModalExito()">
          {{ modalTitulo() === 'Â¡Buen Trabajo!' ? 'Volver al Panel' : 'Aceptar' }}
        </button>
      </div>
    </div>
  </div>
}

<div class="content">
  <div class="pedido-container">
    <button class="btn-volver" (click)="volverAlPanel()">â† Volver</button>

    @if (loading()) {
      <div class="loading">
        <div class="loading-spinner"></div>
        <p>Cargando pedido...</p>
      </div>
    } @else {
      @if (pedido(); as p) {
        <!-- Encabezado -->
        <div class="pedido-header">
          <div class="header-left">
            <h2>Pedido #{{ p.id }}</h2>
          </div>
          <div class="header-right">
            <p class="total">${{ p.total }}</p>
          </div>
        </div>

        <!-- InformaciÃ³n Principal -->
        <div class="info-card restaurante-card">
          <h3>ğŸª Restaurante</h3>
          <p><strong>{{ p.restauranteNombre }}</strong></p>
          <p class="direccion">{{ p.restauranteDireccion }}</p>
        </div>

        <div class="info-card cliente-card">
          <h3>ğŸ‘¤ Cliente</h3>
          <p><strong>{{ p.clienteNombre }}</strong></p>
          <p class="direccion">{{ p.direccionEntrega }}</p>
        </div>

        <!-- Detalles -->
        <div class="detalles-card">
          <div class="detalle-item">
            <span class="label">ğŸ“… Fecha del Pedido:</span>
            <span class="valor">{{ p.fechaPedido | date: 'dd/MM/yyyy HH:mm' }}</span>
          </div>
          <div class="detalle-item">
            <span class="label">ğŸ“® CÃ³digo Postal:</span>
            <span class="valor">{{ p.codigoPostal || 'No especificado' }}</span>
          </div>
        </div>

        <!-- Timeline de Estados -->
        <div class="timeline-container">
          <h3>ğŸ“Š Estado de Entrega</h3>
          <div class="timeline">
            <!-- Estado: Enviado -->
            <div
              class="timeline-item"
              [class.active]="p.estado === 'ENVIADO' || p.estado === 'ENTREGADO'"
            >
              <div class="timeline-dot"></div>
              <div class="timeline-text">
                <p class="timeline-label">Enviado</p>
                <p class="timeline-desc">El pedido estÃ¡ en camino al cliente</p>
              </div>
            </div>

            <!-- Estado: Entregado -->
            <div class="timeline-item" [class.active]="p.estado === 'ENTREGADO'">
              <div class="timeline-dot"></div>
              <div class="timeline-text">
                <p class="timeline-label">Entregado</p>
                <p class="timeline-desc">Pedido completado exitosamente</p>
                @if (p.estado === 'ENVIADO') {
                  <button class="btn-cambiar-estado btn-entregado" (click)="marcarComoEntregado()">
                    âœ“ Marcar como Entregado
                  </button>
                }
              </div>
            </div>
          </div>
        </div>
      } @else {
        <div class="sin-pedido">
          <p>âŒ No hay un pedido actualmente en entrega</p>
          <button class="btn-volver" (click)="volverAlPanel()">Volver al Panel</button>
        </div>
      }
    }
  </div>
</div>

<app-footer-repartidor></app-footer-repartidor>

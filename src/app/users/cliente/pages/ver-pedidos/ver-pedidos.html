<app-header></app-header>

<main class="ver-pedidos">
  <div class="container">    
<h2>Mis Pedidos Activos</h2>
    
    <div class="pedidos-layout">
      <!-- Lista de Pedidos (Izquierda) -->
      <div class="pedidos-lista">
        @if (loading) {
          <div class="loading">
            <div class="loading-spinner"></div>
            <p>Cargando pedidos...</p>
          </div>
        } @else if (error) {
          <div class="error-message">
            <p>{{ error }}</p>
            <button class="retry-btn" (click)="cargarPedidos()">Reintentar</button>
          </div>
        } @else if (pedidos.length === 0) {
          <div class="empty-state">
            <p>No tienes pedidos activos</p>
            <p class="subtitle">Los pedidos aparecer√°n aqu√≠ cuando realices un pedido</p>
          </div>
        } @else {
          <div class="pedidos-grid">
            @for (pedido of pedidos; track pedido.id) {
              <div class="pedido-card" (click)="seleccionarPedido(pedido.id)"
                   [class.selected]="pedidoSeleccionado?.id === pedido.id">
                <div class="pedido-header">
                  <h3>Pedido #{{ pedido.id }}</h3>
                  <span class="estado-badge" 
                        [style.background-color]="getEstadoColor(pedido.estado)">
                    {{ formatearEstado(pedido.estado) }}
                  </span>
                </div>
                
                <div class="pedido-info">
                  <p class="fecha">{{ pedido.fecha | date:'dd/MM/yyyy HH:mm' }}</p>
                  <p class="total-small">{{ formatearPrecio(pedido.total) }}</p>
                </div>
                
                <div class="pedido-total">
                  <span class="total">{{ formatearPrecio(pedido.total) }}</span>
                </div>
              </div>
            }
          </div>        
}
      </div>

      <!-- Panel de Detalle (Derecha) -->
      <div class="detalle-panel">
        @if (!pedidoSeleccionado && !loadingDetalle) {
          <div class="detalle-vacio">
            <div class="detalle-placeholder">
              <h3>Selecciona un pedido</h3>
              <p>Haz clic en un pedido de la izquierda para ver sus detalles</p>
            </div>
          </div>
        } @else if (loadingDetalle) {
          <div class="loading-detalle">
            <div class="loading-spinner"></div>
            <p>Cargando detalles...</p>
          </div>       
 } @else if (pedidoSeleccionado) {
          <div class="detalle-content">
            <!-- Header del detalle con men√∫ de opciones -->
            <div class="detalle-header">
              <div class="detalle-titulo">
                <h3>Pedido #{{ pedidoSeleccionado.id }}</h3>
                <span class="estado-badge" 
                      [style.background-color]="getEstadoColor(pedidoSeleccionado.estado)">
                  {{ formatearEstado(pedidoSeleccionado.estado) }}
                </span>
              </div>
              
              @if (puedeSerCancelado(pedidoSeleccionado.estado)) {
                <div class="menu-opciones">
                  <button class="menu-btn" (click)="toggleMenuOpciones()">‚ãØ</button>
                  @if (mostrarMenuOpciones) {
                    <div class="menu-dropdown">
                      <button class="menu-item" (click)="cancelarPedido()">
                        ‚ùå Cancelar Pedido
                      </button>
                    </div>
                  }
                </div>
              }
            </div>

            <!-- Informaci√≥n del Restaurante -->
            <div class="detalle-seccion">
              <h4>Restaurante</h4>
              <p class="restaurante-nombre">üçΩÔ∏è {{ pedidoSeleccionado.nombreRestaurante }}</p>
              <p class="fecha">üìÖ {{ pedidoSeleccionado.fecha | date:'dd/MM/yyyy HH:mm' }}</p>
            </div>

            <!-- Productos del Pedido -->
            <div class="detalle-seccion">
              <h4>Productos</h4>
              <div class="productos-lista">
                @for (detalle of pedidoSeleccionado.detalles; track detalle.productoId) {
                  <div class="producto-item">
                    <div class="producto-info">
                      <span class="producto-nombre">{{ detalle.nombreProducto || 'Producto' }}</span>
                      <span class="producto-cantidad">x{{ detalle.cantidad }}</span>
                    </div>
                    <div class="producto-precios">
                      @if (detalle.precioUnitario) {
                        <span class="precio-unitario">{{ formatearPrecio(detalle.precioUnitario) }} c/u</span>
                        <span class="precio-subtotal">{{ formatearPrecio(detalle.precioUnitario * detalle.cantidad) }}</span>
                      } @else {
                        <span class="precio-info">Precio no disponible</span>
                      }
                    </div>
                  </div>
                }
              </div>
            </div>

            <!-- Total -->
            <div class="detalle-seccion">
              <div class="total-pedido">
                <h4>Total: {{ formatearPrecio(pedidoSeleccionado.total) }}</h4>
              </div>
            </div>

            <!-- Informaci√≥n adicional no disponible en este momento -->
            <div class="detalle-seccion">
              <p class="info-note">üí° Direcci√≥n y m√©todo de pago disponibles pr√≥ximamente</p>
            </div>
          </div>
        }
      </div>
    </div>
  </div>
</main>
<app-footer-cliente></app-footer-cliente>
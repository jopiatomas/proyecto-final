<app-header></app-header>
<div class="perfil-container">
  <div class="container">
    <div class="header-section">
      <h2>Mi Perfil</h2>
      @if (usuario()) {
        <p class="welcome-text">Bienvenido, <strong>{{ usuario()!.nombre }}</strong></p>
      }
    </div>

    @if (successMessage()) {
      <div class="success-message">{{ successMessage() }}</div>
    }
    @if (errorMessage()) {
      <div class="error-message">{{ errorMessage() }}</div>
    }

    @if (loading()) {
      <div class="loading-section">
        <div class="loading-spinner"></div>
        <p>Cargando datos del perfil...</p>
      </div>
    } @else {
      <div class="perfil-content">
        <form class="perfil-form" [formGroup]="perfilForm" (ngSubmit)="onSubmit()">
          <h3>Informaci√≥n Personal</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label>Nombre completo *</label>
              <input 
                type="text" 
                formControlName="nombre" 
                class="form-input"
                [class.error]="isFieldInvalid('nombre')"
                placeholder="Ingresa tu nombre completo"
                maxlength="50"
              />
              @if (perfilForm.get('nombre')?.invalid && perfilForm.get('nombre')?.touched) {
                <div class="form-error">
                  @if (perfilForm.get('nombre')?.errors?.['required']) {
                    El nombre es requerido
                  }
                  @if (perfilForm.get('nombre')?.errors?.['minlength']) {
                    M√≠nimo 3 caracteres
                  }
                  @if (perfilForm.get('nombre')?.errors?.['maxlength']) {
                    M√°ximo 50 caracteres
                  }
                </div>
              }
            </div>

            <div class="form-group">
              <label>Usuario *</label>
              <input 
                type="text" 
                formControlName="usuario" 
                class="form-input"
                [class.error]="isFieldInvalid('usuario')"
                placeholder="Nombre de usuario"
                maxlength="18"
              />
              @if (perfilForm.get('usuario')?.invalid && perfilForm.get('usuario')?.touched) {
                <div class="form-error">
                  @if (perfilForm.get('usuario')?.errors?.['required']) {
                    El usuario es requerido
                  }
                  @if (perfilForm.get('usuario')?.errors?.['minlength']) {
                    M√≠nimo 3 caracteres
                  }
                  @if (perfilForm.get('usuario')?.errors?.['maxlength']) {
                    M√°ximo 18 caracteres
                  }
                  @if (perfilForm.get('usuario')?.errors?.['pattern']) {
                    Solo letras y n√∫meros
                  }
                </div>
              }
            </div>
          </div>

          <div class="form-group">
            <label>Email *</label>
            <input 
              type="email" 
              formControlName="email" 
              class="form-input"
              [class.error]="isFieldInvalid('email')"
              placeholder="tu@email.com"
              maxlength="100"
            />
            @if (perfilForm.get('email')?.invalid && perfilForm.get('email')?.touched) {
              <div class="form-error">
                @if (perfilForm.get('email')?.errors?.['required']) {
                  El email es requerido
                }
                @if (perfilForm.get('email')?.errors?.['email']) {
                  Email inv√°lido
                }
                @if (perfilForm.get('email')?.errors?.['maxlength']) {
                  M√°ximo 100 caracteres
                }
              </div>
            }
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Tel√©fono</label>
              <input 
                type="tel" 
                formControlName="telefono" 
                class="form-input"
                [class.error]="isFieldInvalid('telefono')"
                placeholder="+54 11 1234-5678"
                maxlength="20"
              />
              @if (perfilForm.get('telefono')?.invalid && perfilForm.get('telefono')?.touched) {
                <div class="form-error">
                  @if (perfilForm.get('telefono')?.errors?.['pattern']) {
                    Formato de tel√©fono inv√°lido
                  }
                </div>
              }
            </div>

            <div class="form-group">
              <label>Direcci√≥n</label>
              <input 
                type="text" 
                formControlName="direccion" 
                class="form-input"
                [class.error]="isFieldInvalid('direccion')"
                placeholder="Tu direcci√≥n principal"
                maxlength="200"
              />
              @if (perfilForm.get('direccion')?.invalid && perfilForm.get('direccion')?.touched) {
                <div class="form-error">
                  @if (perfilForm.get('direccion')?.errors?.['maxlength']) {
                    M√°ximo 200 caracteres
                  }
                </div>
              }
            </div>
          </div>

          <div class="form-actions">
            <button 
              type="submit" 
              class="btn-primary"
              [disabled]="loading()"
            >
              @if (loading()) {
                <span class="btn-loading"></span>
                Guardando...
              } @else {
                <span class="btn-icon"></span>
                Guardar Cambios
              }
            </button>
          </div>
        </form>

        <div class="quick-links">
          <h3>Accesos R√°pidos</h3>
          <button class="link-card" (click)="navegarA('/cliente/direcciones')">
            <span class="icon">üìç</span>
            <div>
              <h4>Mis Direcciones</h4>
              <p>Gestiona tus direcciones de entrega</p>
            </div>
            <span class="arrow">‚Üí</span>
          </button>
          <button class="link-card" (click)="navegarA('/cliente/metodos-pago')">
            <span class="icon">üí≥</span>
            <div>
              <h4>M√©todos de Pago</h4>
              <p>Administra tus tarjetas</p>
            </div>
            <span class="arrow">‚Üí</span>
          </button>
          <button class="link-card" (click)="navegarA('/cliente/pedidos')">
            <span class="icon">üì¶</span>
            <div>
              <h4>Mis Pedidos</h4>
              <p>Ver historial de pedidos</p>
            </div>
            <span class="arrow">‚Üí</span>
          </button>
        </div>
      </div>
    }
  </div>
</div>

<app-footer></app-footer>

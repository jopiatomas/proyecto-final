<app-header></app-header>

<div class="content">
  <div class="container">
    <h2>Gestión de Direcciones</h2>

    <div class="direcciones-section">
      <div class="direcciones-main">
        <div class="actions-bar">
          <button class="btn-nuevo" (click)="abrirPanel()">
            <span class="icon">+</span> Agregar Dirección
          </button>
        </div>

        <h3>Direcciones ({{direcciones().length}})</h3>

        @if (loading()) {
          <div class="loading"><div class="spinner"></div></div>
        }

        @if (!loading() && direcciones().length === 0) {
          <p class="empty">No hay direcciones registradas</p>
        }

        @if (!loading() && direcciones().length > 0) {
          <div class="direcciones-list">
            @for (direccion of direcciones(); track direccion.id) {
              <div class="direccion-item" (click)="editarDireccion(direccion)">
                <div class="direccion-header">
                  <span class="direccion-nombre">{{direccion.direccion}}</span>
                </div>
                <div class="direccion-info">
                  <p class="descripcion">{{direccion.ciudad}}, {{direccion.pais}}</p>
                  <div class="direccion-meta">
                    <span class="cp-badge">CP: {{direccion.codigoPostal}}</span>
                  </div>
                </div>
              </div>
            }
          </div>
        }
      </div>

      @if (panelAbierto()) {
        <div class="direccion-form-panel">
          <div class="panel-header">
            <h4>{{ editandoId() ? 'Editar Dirección' : 'Nueva Dirección' }}</h4>
            <button class="close-btn" (click)="cerrarPanel()">×</button>
          </div>

          <form class="panel-content" [formGroup]="direccionForm" (ngSubmit)="guardarDireccion()">
            <div class="form-section">
              <div class="form-group">
                <label for="direccion">Dirección *</label>
                <input
                  type="text"
                  id="direccion"
                  formControlName="direccion"
                  placeholder="Ej: Av. Corrientes 1234"
                />
                @if (direccionForm.get('direccion')?.invalid && direccionForm.get('direccion')?.touched) {
                  <small class="error">Dirección requerida (mínimo 5 caracteres)</small>
                }
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="ciudad">Ciudad *</label>
                  <input
                    type="text"
                    id="ciudad"
                    formControlName="ciudad"
                    placeholder="Ej: Buenos Aires"
                  />
                  @if (direccionForm.get('ciudad')?.invalid && direccionForm.get('ciudad')?.touched) {
                    <small class="error">Ciudad requerida</small>
                  }
                </div>

                <div class="form-group">
                  <label for="pais">País *</label>
                  <input
                    type="text"
                    id="pais"
                    formControlName="pais"
                    placeholder="Ej: Argentina"
                  />
                  @if (direccionForm.get('pais')?.invalid && direccionForm.get('pais')?.touched) {
                    <small class="error">País requerido</small>
                  }
                </div>
              </div>

              <div class="form-group">
                <label for="codigoPostal">Código Postal *</label>
                <input
                  type="text"
                  id="codigoPostal"
                  formControlName="codigoPostal"
                  placeholder="Ej: 1425"
                />
                @if (direccionForm.get('codigoPostal')?.invalid && direccionForm.get('codigoPostal')?.touched) {
                  <small class="error">CP requerido (4-5 dígitos)</small>
                }
              </div>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn-guardar">
                {{ editandoId() ? 'Guardar Cambios' : 'Agregar Dirección' }}
              </button>
              @if (editandoId()) {
                <button type="button" class="btn-eliminar" (click)="eliminarDireccion(editandoId()!)">
                  Eliminar Dirección
                </button>
              }
              <button type="button" class="btn-cancelar" (click)="cerrarPanel()">
                Cancelar
              </button>
            </div>
          </form>
        </div>
      }
    </div>
  </div>
</div>

<app-footer></app-footer>

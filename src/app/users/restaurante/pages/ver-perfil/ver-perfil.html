<app-header></app-header>

<div class="perfil-container">
  <div class="perfil-content">
    <h1>Mi Perfil</h1>

    <!-- Mensajes de éxito/error -->
    @if (successMessage()) {
      <div class="alert alert-success">
        {{ successMessage() }}
      </div>
    }
    @if (errorMessage()) {
      <div class="alert alert-error">
        {{ errorMessage() }}
      </div>
    }

    <!-- Loading spinner -->
    @if (isLoading()) {
      <div class="loading">
        <div class="spinner"></div>
        <p>Cargando...</p>
      </div>
    }

    <!-- Modo Vista -->
    @if (!isEditing() && profile() && !isLoading()) {
      <div class="perfil-card">
        <div class="perfil-header">
          <div class="perfil-avatar">
            <img src="/image.png" alt="Avatar del usuario" />
          </div>
          <div class="perfil-info">
            <h2>{{ profile()?.nombre }}</h2>
            <p class="rol-badge">{{ role() }}</p>
          </div>
        </div>

        <div class="perfil-details">
          <div class="detail-item">
            <label>Usuario:</label>
            <span>{{ profile()?.usuario }}</span>
          </div>
          <div class="detail-item">
            <label>Nombre del Restaurante:</label>
            <span>{{ profile()?.nombre }}</span>
          </div>
          <div class="detail-item">
            <label>Contraseña:</label>
            <span>********</span>
          </div>
          <div class="detail-item">
            <label>Rol:</label>
            <span>{{ role() }}</span>
          </div>
        </div>

        <div class="perfil-actions">
          <button class="btn btn-primary" (click)="enableEdit()">
            Modificar Datos
          </button>
          <button class="btn btn-secondary" (click)="togglePasswordChange()">
            Cambiar Contraseña
          </button>
        </div>
      </div>
    }

    <!-- Modo Edición -->
    @if (isEditing() && !isLoading()) {
      <div class="perfil-card">
        <h2>Editar Perfil</h2>
        <p class="info-text">Solo puedes modificar tu usuario y nombre de restaurante</p>
        <form class="edit-form" (ngSubmit)="saveProfile()">
          <div class="form-group">
            <label for="usuario">Usuario:</label>
            <input
              type="text"
              id="usuario"
              name="usuario"
              [(ngModel)]="editForm.usuario"
              required
              placeholder="Ingresa tu usuario"
            />
          </div>

          <div class="form-group">
            <label for="nombre">Nombre del Restaurante:</label>
            <input
              type="text"
              id="nombre"
              name="nombre"
              [(ngModel)]="editForm.nombre"
              required
              placeholder="Ingresa el nombre del restaurante"
            />
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary">
              Guardar Cambios
            </button>
            <button type="button" class="btn btn-secondary" (click)="cancelEdit()">
              Cancelar
            </button>
          </div>
        </form>
      </div>
    }

    <!-- Formulario de Cambio de Contraseña -->
    @if (showPasswordChange() && !isEditing()) {
      <div class="perfil-card password-card">
        <h2>Cambiar Contraseña</h2>
        <form class="password-form" (ngSubmit)="changePassword()">
          <div class="form-group">
            <label for="currentPassword">Contraseña Actual:</label>
            <input
              type="password"
              id="currentPassword"
              name="currentPassword"
              [(ngModel)]="passwordForm.currentPassword"
              required
              placeholder="Contraseña actual"
            />
          </div>

          <div class="form-group">
            <label for="newPassword">Nueva Contraseña:</label>
            <input
              type="password"
              id="newPassword"
              name="newPassword"
              [(ngModel)]="passwordForm.newPassword"
              required
              placeholder="Nueva contraseña (mínimo 6 caracteres)"
            />
          </div>

          <div class="form-group">
            <label for="confirmPassword">Confirmar Nueva Contraseña:</label>
            <input
              type="password"
              id="confirmPassword"
              name="confirmPassword"
              [(ngModel)]="passwordForm.confirmPassword"
              required
              placeholder="Confirma la nueva contraseña"
            />
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary" [disabled]="isLoading()">
              Cambiar Contraseña
            </button>
            <button type="button" class="btn btn-secondary" (click)="togglePasswordChange()">
              Cancelar
            </button>
          </div>
        </form>
      </div>
    }
  </div>
</div>

<app-footer></app-footer>
